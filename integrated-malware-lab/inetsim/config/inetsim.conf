# INetSim Configuration File
# Malware Analysis Lab - Integrated Configuration
#
# Documentation: https://www.inetsim.org/documentation.html
# Update: Feb 2026 - Dynamic Analysis Lab

###############################################################################
# NETWORK CONFIGURATION
###############################################################################

# Server IP Address (bind to all interfaces)
server_version Windows 10.0

# DNS Service Configuration
# Primary DNS server binding
service_binds 0.0.0.0:53     # DNS (UDP/TCP) on port 53
dns_default_ip 172.20.0.2     # Default IP for DNS responses

# Wildcard DNS resolution
dns_default_ttl 3600
dns_bind_redirect_enable 1     # Enable DNS redirect for unmatched queries

###############################################################################
# BASIC SERVICES CONFIGURATION
###############################################################################

# SMTP Service (Port 25)
service_binds 0.0.0.0:25       # SMTP service
smtp_version MTA 5.8.3         # SMTP version string
smtp_log_traffic 1

# POP3 Service (Port 110) - Optional
# service_binds 0.0.0.0:110
# pop3_version POP3 4.17

# IMAP Service (Port 143) - Optional
# service_binds 0.0.0.0:143
# imap_version IMAP 4.1

# FTP Service (Port 21)
service_binds 0.0.0.0:21       # FTP service
ftp_version FTP 2.0.0          # FTP version string
ftp_default_username admin
ftp_default_password admin
ftp_log_traffic 1

# TFTP Service (Port 69 UDP) - Optional
# service_binds 0.0.0.0:69/udp

###############################################################################
# WEB SERVICES (HTTP/HTTPS) - FALLBACK
# Note: FakeNet-NG xử lý HTTP/HTTPS chính, INetSim làm fallback
###############################################################################

# HTTP Service (Port 80)
service_binds 0.0.0.0:80       # HTTP service
http_version HTTP/1.1
http_log_traffic 1
http_fake_files 1              # Trả về fake files khi request

# HTTPS Service (Port 443)
service_binds 0.0.0.0:443      # HTTPS service (SSL/TLS)
https_version HTTP/1.1
https_log_traffic 1

###############################################################################
# ADDITIONAL SERVICES
###############################################################################

# NTP Service (Port 123 UDP) - Optional
# service_binds 0.0.0.0:123/udp
# ntp_log_traffic 1

# Syslog Service (Port 514 UDP) - Optional (để monitor malware activity)
# service_binds 0.0.0.0:514/udp
# syslog_log_traffic 1

# IRC Service (Port 6667) - Optional
# service_binds 0.0.0.0:6667
# irc_version ircd 2.11

# VNC Service (Port 5900) - Optional
# service_binds 0.0.0.0:5900
# vnc_log_traffic 1

###############################################################################
# LOGGING CONFIGURATION
###############################################################################

# Log file location
log_file /var/log/inetsim/inetsim.log

# Log level: error | warning | info | debug
log_level debug

# Log traffic details
log_traffic 1

# Log all DNS queries
dns_log_traffic 1

# Log file format
log_format [%d.%m.%Y %H:%M:%S]

###############################################################################
# FILE SERVING CONFIGURATION
###############################################################################

# Directory containing fake files
# datadir /etc/inetsim/data

# Configuration file for fake files
fakefile_conf /etc/inetsim/fakefile.conf

###############################################################################
# STATISTICS
###############################################################################

# Enable statistics (show when server stops)
stat_enable 1

# Statistics file
stat_file /var/log/inetsim/statistics.txt

###############################################################################
# ADVANCED OPTIONS
###############################################################################

# Maximum connections per service
max_conn 100

# Request timeout (seconds)
request_timeout 30

# Connection timeout (seconds)
connection_timeout 60

# Enable IPv6 support
ipv6_enable 0

# Custom error responses
http_error_response 404 404_NotFound.html
http_error_response 500 500_ServerError.html

###############################################################################
# SECURITY OPTIONS
###############################################################################

# Disable service after X seconds of no activity
tcp_timeout 600
udp_timeout 300

# Require authentication for sensitive services
# pop3_require_auth 1
# imap_require_auth 1

###############################################################################
# FILTER CONFIGURATION (Optional)
# Để bypass traffic nhất định hoặc thêm logic đặc biệt
###############################################################################

# Format: filter <service> <source_port> <target_port> <direction> <action>
# direction: in | out
# action: allow | block | redirect

# Allow traffic từ analyzer container
# filter * * * in allow

###############################################################################
# NOTES FOR MALWARE ANALYSIS
###############################################################################
# 1. INetSim sẽ xử lý tất cả DNS queries (default)
# 2. SMTP/FTP/HTTP/HTTPS services sẽ simulate các dịch vụ thực tế
# 3. Tất cả traffic sẽ được log để phân tích
# 4. FakeNet-NG sẽ xử lý HTTP/HTTPS phức tạp hơn
# 5. Nếu malware yêu cầu dịch vụ không được support, nó sẽ timeout

FROM ubuntu:22.04

# Cập nhật package manager
RUN apt-get update && apt-get install -y \
    ca-certificates \
    build-essential \
    curl \
    git \
    dnsmasq \
    dnsutils \
    net-tools \
    netcat-openbsd \
    iproute2 \
    iptables \
    iputils-ping \
    wget \
    vim \
    nano \
    sudo \
    supervisor \
    python3 \
    python3-pip \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

# Cài đặt INetSim - Package simulation cho DNS, SMTP, FTP
RUN apt-get update && apt-get install -y \
    inetsim \
    && rm -rf /var/lib/apt/lists/*

# Tạo log directory
RUN mkdir -p /var/log/inetsim /var/log/supervisor

# Copy entrypoint script
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Set working directory
WORKDIR /etc/inetsim

# Expose ports
EXPOSE 53/udp 53/tcp 21 25 80 443 8080 8443

# Chạy entrypoint script
CMD ["/entrypoint.sh"]
